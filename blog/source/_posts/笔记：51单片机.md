---
title: 笔记：51单片机
---

# 51单片机笔记



# 软件准备



## Keil5

用于单片机的源码编写和编译，去官网下载注意使用C51版本



####  1.官网下载

前往 Https://www.keil.com 下载

####  2.白嫖资料包

江科大的资料包

百度网盘:https://pan.baidu.com/share/init?surl=vDTN2o8ffvczzNQGfyjHng

密码:gdzff

###### 注意，这玩应安装的时候不会自己创建文件夹，不手动创建空文件夹，就会乱装。

在安装后，打开目录找到`TOOLS.INI `找到PATH项，修改路径为安装路径

#### 3.Keil5的破解

##### 1.在安装包中打开KEIL_LIC破解程序运行

[![Keil破解教程-1.png](https://bu.dusays.com/2023/05/07/6456ea7893efc.png)](https://bu.dusays.com/2023/05/07/6456ea7893efc.png)

##### 2.将Keil5以管理员身份运行

##### 3.打开后点击Feil中的License Management项，查看License Management窗口右上角的computer ID中的CID，将其复制

##### 4.在KEIL_LIC的CID栏粘贴后点击下方Generate

[![Keil破解教程-2.png](https://bu.dusays.com/2023/05/07/6456eb972a253.png)](https://bu.dusays.com/2023/05/07/6456eb972a253.png)

#### 5.复制到Keil5的LIC，点击Add LIC，完成破解



------





## STC-ISP烧录软件与USB驱动

### STC-ISP软件

在资料包中，STC-ISP可直接复制至桌面

### USB驱动

打开“stc-isp\USB to UART Driver\CH340_CH341”文件夹，双击运行ch341ser.exe程序，默认安装即可，等待“驱动安装成功”窗口弹出即可

###### 在C盘可以找到"WCH.CN文件夹“即为安装成功





------





# 单片机介绍



### 单片机定义

- 单片机，英文“Micro Controller Unit“,简称MCU

- 内部集成了CPU、RAM、ROM、定时器、终端系统、通讯接口等一系列电脑的常用硬件功能
- 单片机的任务是信息采集（依靠传感器）、处理（依靠CPU）和硬件设备（例如点击，LED等）的控制
- 单片机和计算机相比，单片机算是一个袖珍版计算机，一个芯片就能构成完整的计算机系统。但在性能上，与计算机相差甚远，但单片机成本低、体积小、结构简单，也是了解计算机原理与结构的最佳选择



### STC89C52RC单片机参数

淘宝普遍使用的是普中科技的开发板，芯片是带RC结尾，与江科大的公开课使用的开发板略有差异，并无过大差异

- 所属系列：51单片机系列
- 公司：STC公司
- 位数：8位
- RAM：512字节
- ROM：8K（Flash）
- 工作频率：11.0592MHz（晶振频率）



### 51单片机名称的由来

51单片机是指使用80年代Intel开发的8051单片机内核的统称。

也指对所有兼容Intel 8031指令系统的单片机的统称。



### 命名规则

[![STC89C52命名规则.png](https://bu.dusays.com/2023/05/07/6456ea789e436.png)](https://bu.dusays.com/2023/05/07/6456ea789e436.png)

------



# 练习工程



## 1-1 点亮LED



### 1.创建工程

运行Keil5后，在上侧工具栏中点击`Project`中的`New μVision Project`项，自选一个文件位置存放项目，同样要手动创建新的文件夹。

创建后会跳出选择CPU的窗口，选择`AT89C52`（不同公司的生产，但是具体参数一样）

[![点亮LED-创建工程-1.png](https://bu.dusays.com/2023/05/07/6456ea788df6b.png)](https://bu.dusays.com/2023/05/07/6456ea788df6b.png)

创建后应当弹出本窗口，未弹出应当检查`TOOLS.INI`配置文件中的`PATH`项是否更改为正确的程序路径

 创建成功后在侧边栏按照下列路径右键`Source Group 1`

[![点亮LED-创建工程-2.png](https://bu.dusays.com/2023/05/07/6456ea789f80c.png)](https://bu.dusays.com/2023/05/07/6456ea789f80c.png)

选择`Add New Item to Group 'Source Group1'`

[![点亮LED-创建工程-3.png](https://bu.dusays.com/2023/05/07/6456ea797f18b.png)](https://bu.dusays.com/2023/05/07/6456ea797f18b.png)

在下面选择"C File(. c)"文件(可用不同语言，本笔记使用的语言是C)-`name`填写`main`

[![点亮LED-创建工程-4.png](https://bu.dusays.com/2023/05/07/6456ea7999f3c.png)](https://bu.dusays.com/2023/05/07/6456ea7999f3c.png)



### 2.基础原理



#### CPU与寄存器

CPU通过软件直接访问寄存器，直接写值，从而实现CPU操作引脚

寄存器就是一种特殊存储器，以八个为一组来分组，相当于按钮，每个存储器下面都连着一根线，用以控制电路。

寄存器通向引脚会经过驱动器，增大电流，之后连接至I/O端口

CPU给寄存器写 `1`为高电平，此时LED两端皆为高电平，无法点亮

给寄存器写`0`为低电平，两端互通，产生5V电压，LED点亮

[![CPU操控原理.png](https://bu.dusays.com/2023/05/07/6456ea7887807.png)](https://bu.dusays.com/2023/05/07/6456ea7887807.png)

#### 如何LED确定引脚

[![点亮LED-原理-为什么P2_0是第一个LED灯.png](https://bu.dusays.com/2023/05/07/6456ea79d66ac.png)](https://bu.dusays.com/2023/05/07/6456ea79d66ac.png)

图中`D1`LED灯为点亮目标，根据原理图可以看到其受`P20`引脚控制，在软件中其为`P2_0`变量，不同的电子元件有不同的控制引脚，具体操控引脚在原理图中查看。





### 3.程序编写

在程序中，对串口应用应使用十六进制进行赋值，在赋值时应添加十六进制标识符，即`0x--`，**且右位是低位**，如点亮第一个LED灯，应为`P2`串口赋值`1111 1110(B)`,转成十六进制为`0xFE(H)`

下列为示例代码



```c
#include <REGX52.H>
//添加51单片机程序的头文件，使程序可以为串口赋值

void main()
{
    //'0x'代表声明是十六位进制，'FE'则对应的是 '1111 1110',遵守右位是低位
    P2 = 0xFE;
    
}
```



[![二进制转十六进制对照表.png](https://bu.dusays.com/2023/05/07/6456ea78a1ef9.png)](https://bu.dusays.com/2023/05/07/6456ea78a1ef9.png)





### 4.编译与下载



#### 编译

1. 点击控件栏第一个控件(见图中箭头所指)

2. 弹出窗口后，选择`OutPut`栏

3. 勾选`create HEX File`项，即可生成编译后的单片机可执行文件

   ###### 每一个项目都要重复此步骤

[![程序编译与烧录-2.png](https://bu.dusays.com/2023/05/07/6456ea7a1d2fb.png)](https://bu.dusays.com/2023/05/07/6456ea7a1d2fb.png)



#### 下载

1. 打开STC-ISP软件

2. 将单片机连接至电脑

3. 选择单片机型号`STC89C52`型号

4. 点击''打开程序文件''，选择Keil5项目保存的路径，打开对应项目的`Objects`文件夹，选择里面的`.hex`后缀名文件

   ###### 如果没有，请检查路径是否正确，是否在Keil5中设置编译生成文件，设置编译请向上翻看

   

[![程序编译与烧录.png](https://bu.dusays.com/2023/05/07/6456ea7a65186.png)](https://bu.dusays.com/2023/05/07/6456ea7a65186.png)

完成后点击"下载"，随后重启单片机，即可看到烧录成功，程序开始运转





------



## 1-2 LED闪烁

### 1.程序逻辑

##### 程序需求：使第一个LED灯以1s为周期，亮灭各500ms闪烁



##### 编写逻辑

- 需要编写一个重复空运行500ms，不执行任何操作的延时函数
- 需要一个死循环，其内部执行:点亮第一个LED -> 延时500ms -> 熄灭第一个LED -> 延时500ms



### 2.程序编写

#### 创建工程

创建工程请参考`1-1点亮LED`的教程

#### 编写代码

###### 延时函数

首先，按照程序逻辑，需要编写一个延时函数，延时函数可以通过使用STC-ISP下载器中自带的**软件延时计算器**来生成函数

食用方法

1. 设定系统频率，江科大使用的晶振频率是`12MHz`，目前各大购物平台出售的开发板更多使用`11.0592MHz`，具体数据请询问店家或自行查看晶振上的参数。
2. 设置定时长度，注意单位是毫秒还是秒
3. 8051指令集选择`STC-Y1`,此指令集适用于`STC89Cxx/STC89LExx/STC90Cxx/STC90LExx`系列
4. 设定好参数后，点击`生成C代码`,将其复制到程序中

[![延时函数教程.png](https://bu.dusays.com/2023/05/07/6456ea78ac0f4.png)](https://bu.dusays.com/2023/05/07/6456ea78ac0f4.png)

###### 完整代码

```c
#include <REGX52.H>
//添加51单片机程序的头文件，使程序可以为串口赋值
#include <INTRINS.H>
//此为延时函数运行所需要的头文件

void Delay500ms()//延时函数，通过重复空运行实现 
{
    unsigned char i,j,k;
    _hop_();
    i = 4;
    j = 129;
    k = 119;
    do
    {
       do
       {
           while(--k);
       }while(--j);
    }while(--i);
}

void main()
{
    while(1)//while的判断语句填写1即为非零的数，使判断始终为真，成为死循环
    {
    	P2 = 0xFE;//点亮第一个LED
        Delay500ms();//调用延时函数
        P2 = 0xFF;//全部熄灭
        Delay500ms();//调用延时函数
        
    }
}
```





#### 编译下载

请参考`1-1点亮LED`中的`4.编译与下载`文章，切记编译时要点击勾选工具栏中的`create HEX File`项，以生成可执行文件



------



## 1-3 LED流水灯



### 1.程序逻辑

##### 程序需求：使八个LED灯依次闪烁，每个灯亮时间可以在程序设计阶段修改，重复循环。

##### 编写逻辑

- 需要编写一个重复空运行1ms，不执行任何操作的延时函数，形参列表可以接受无符号整型，延时时间受形参列表控制
- 需要一个死循环，其内部执行:点亮第一个LED -> 延时设定时间 -> 点亮第二个LED -> 延时设定时间->············直到第八个，重复此过程



### 2.程序编写

#### 创建工程

创建工程请参考`1-1点亮LED`的教程



#### 编写代码

###### 延时函数

首先，按照程序逻辑，需要编写一个延时函数，延时函数可以通过使用STC-ISP下载器中自带的**软件延时计算器**来生成函数

食用方法

1. 设定系统频率，江科大使用的晶振频率是`12MHz`，目前各大购物平台出售的开发板更多使用`11.0592MHz`，具体数据请询问店家或自行查看晶振上的参数。
2. 设置定时长度，注意单位是毫秒还是秒
3. 8051指令集选择`STC-Y1`,此指令集适用于`STC89Cxx/STC89LExx/STC90Cxx/STC90LExx`系列
4. 设定好参数后，点击`生成C代码`,**将其复制到程序中**



###### 完整代码

```c
#include <REGX52.H>
//添加51单片机程序的头文件，使程序可以为串口赋值
#include <INTRINS.H>
//此为延时函数运行所需要的头文件

void Delay1ms(unsigned int xms)//延时函数，通过重复空运行实现 
{
    unsigned char i,j;
   
    while(xms)
    {
      i = 2;
      j = 239;
     do
        {
           while(--j);
        }while(--i);
        xms--;
    }
}

void main()
{
    while(1)//while的判断语句填写1即为非零的数，使判断始终为真，成为死循环
    {
    	P2 = 0xFE;
        Delay1ms(123);
        P2 = 0xFD;
        Delay1ms(213);
        P2 = 0xFB;
        Delay1ms(312);
        P2 = 0xF7;
        Delay1ms(234);
        P2 = 0xEF;
        Delay1ms(432);
        P2 = 0xDF;
        Delay1ms(345);
        P2 = 0xBF;
        Delay1ms(645);
        P2 = 0x7F;
        Delay1ms(234);
        
    }
}
```

#### 编译下载

请参考`1-1点亮LED`中的`4.编译与下载`文章，切记编译时要点击勾选工具栏中的`create HEX File`项，以生成可执行文件



------



# 基础知识

- VCC是正极，GND是负极
- LED的图标为下图，在作为图标时，左正右负；实物LED查看内电极用于分辨，较小的电极为正电极，较大的为负电极。

[![发光二极管.png](https://bu.dusays.com/2023/05/07/6456ea78a1c37.png)](https://bu.dusays.com/2023/05/07/6456ea78a1c37.png)g)

- 电阻102=1K，10为有效数据，2为倍率；例如473即为47 000 = 47K；例如1001 = 100 0 = 1K。也就是说：共有三位时，前二位正常抄，第三位是几就在前两位后加几个零；共有四位时，前三位照抄，第四位是几就加几个零。
- 单片机中，引脚实际输出时5V(高电平)或0V(低电平)，便于理解，可以理解为输出的是 + 或 -.
- 高低电平在单片机中使用的是"TTL电平"(一种协议规范，相当于规定+是5V，-是0V)

  